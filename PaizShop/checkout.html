<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/PaizCorp/PaizShop/PaizShop2.png" sizes="16x16">
    <title>Checkout - Paiz Shop</title>
    <link rel="stylesheet" href="/PaizCorp/PaizShop/styles.css">
</head>

<body>
    <header>
        <h1>Checkout</h1>
    </header>
    <main>
        <form id="checkout-form">
            <label for="name">Name (Optional):</label>
            <input type="text" id="name" name="name">

            <label for="minecraft-name">*Minecraft Name (Required):</label>
            <input type="text" id="minecraft-name" name="minecraft-name" required>

            <label for="contact-info">*Contact Information (Discord/WhatsApp Number) (Required):</label>
            <input type="text" id="contact-info" name="contact-info" required>

            <label for="pickup">*Pickup:</label>
            <input type="radio" id="pickup" name="delivery-option" value="pickup" checked onclick="toggleDelivery(false)">

            <label for="delivery">*Delivery:</label>
            <input type="radio" id="delivery" name="delivery-option" value="delivery" onclick="toggleDelivery(true)">

            <div id="coordinates" style="display:none;">
                <label for="coord-x">Coordinate X:</label>
                <input type="number" id="coord-x" name="coord-x">

                <label for="coord-y">Coordinate Y:</label>
                <input type="number" id="coord-y" name="coord-y">

                <label for="coord-z">Coordinate Z:</label>
                <input type="number" id="coord-z" name="coord-z">
            </div>

            <div id="pickup-address" style="display:none;">
                <p>Pickup Address: 1, Jalan Utama, The LoL City, The LoL</p>
            </div>

            <button type="submit">Checkout</button>
        </form>
    </main>

    <script>
        // Toggle delivery fields based on user selection
        function toggleDelivery(isDelivery) {
            const coordinatesDiv = document.getElementById('coordinates');
            const pickupAddressDiv = document.getElementById('pickup-address');

            if (isDelivery) {
                coordinatesDiv.style.display = 'block';
                pickupAddressDiv.style.display = 'none';
            } else {
                coordinatesDiv.style.display = 'none';
                pickupAddressDiv.style.display = 'block';
            }
        }

        // Trigger the correct display on page load
        document.addEventListener('DOMContentLoaded', function () {
            const deliveryRadio = document.getElementById('delivery').checked;
            toggleDelivery(deliveryRadio);
        });

        // Handle Checkout Form Submission
        document.addEventListener('DOMContentLoaded', function () {
            const checkoutForm = document.getElementById('checkout-form');

            if (checkoutForm) {
                checkoutForm.addEventListener('submit', function (event) {
                    event.preventDefault();

                    const minecraftName = document.getElementById('minecraft-name').value;
                    const contactInfo = document.getElementById('contact-info').value;
                    const deliveryRadio = document.getElementById('delivery').checked;
                    const coordX = document.getElementById('coord-x').value;
                    const coordY = document.getElementById('coord-y').value;
                    const coordZ = document.getElementById('coord-z').value;

                    // Validate Minecraft name
                    if (!minecraftName) {
                        alert("Minecraft Name is required!");
                        return;
                    }

                    // Validate contact information
                    if (!contactInfo) {
                        alert("Contact Information is required!");
                        return;
                    }

                    // Validate coordinates if delivery is selected
                    if (deliveryRadio && (!coordX || !coordY || !coordZ)) {
                        alert("Coordinates are required for delivery!");
                        return;
                    }

                    const selectedItem = JSON.parse(sessionStorage.getItem('selectedItem'));
                    const subtotal = selectedItem.quantity * selectedItem.price;
                    const tax = subtotal * 0.03;
                    let deliveryFee = 0;

                    // Calculate delivery fee if delivery is selected
                    if (deliveryRadio) {
                        deliveryFee = calculateDeliveryFee(coordX, coordY, coordZ);
                    }

                    // Round the total to the nearest whole number
                    let total = subtotal + tax + deliveryFee;
                    total = Math.round(total);

                    // Store order details in sessionStorage
                    sessionStorage.setItem('orderDetails', JSON.stringify({
                        item: selectedItem.item,
                        quantity: selectedItem.quantity,
                        subtotal: subtotal.toFixed(2),
                        tax: tax.toFixed(2),
                        deliveryFee: deliveryFee.toFixed(2),
                        total: total,
                        minecraftName: minecraftName,
                        contactInfo: contactInfo,
                        delivery: deliveryRadio,
                        pickup: !deliveryRadio,
                        address: !deliveryRadio ? '1, Jalan Utama, The LoL City, The LoL' : '',
                        coordinates: deliveryRadio ? { x: coordX, y: coordY, z: coordZ } : null
                    }));

                    // Redirect to the order summary page
                    window.location.href = '/PaizCorp/PaizShop/order-summary'; // Ensure this path matches your actual order summary page
                });
            }
    </script>
</body>

</html>
